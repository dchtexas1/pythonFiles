###############################################################################
# Name: Dax Henson
# Date: 2017/02/1x
# Description: Adventure Text Game
###############################################################################
from time import sleep
###############################################################################
# the blueprint for a room


class Room(object):
    # the constructor

    def __init__(self, name):
        # rooms have a name, exits, exit locations, items, item Descs
        # and grabbables (things that can be taken into inventory)
        self.name = name
        self.exits = []
        self.exitLocations = []
        self.items = []
        self.itemDescs = []
        self.hiddenItems = []
        self.hiddenItemDescs = []
        self.grabbables = []
        self.grabbableDescs = []
        self.interactables = []
        self.interactableDescs = []
        self.interactableState = []
        self.interactableReqs = []
    # getters and setters for the instance variables

    @property
    def name(self):
        return self._name

    @name.setter
    def name(self, value):
        self._name = value

    @property
    def exits(self):
        return self._exits

    @exits.setter
    def exits(self, value):
        self._exits = value

    @property
    def exitLocations(self):
        return self._exitLocations

    @exitLocations.setter
    def exitLocations(self, value):
        self._exitLocations = value

    @property
    def items(self):
        return self._items

    @items.setter
    def items(self, value):
        self._items = value

    @property
    def itemDescs(self):
        return self._itemDescs

    @itemDescs.setter
    def itemDescs(self, value):
        self._itemDescs = value

    @property
    def hiddenItems(self):
        return self._hiddenItems

    @hiddenItems.setter
    def hiddenItems(self, value):
        self._hiddenItems = value

    @property
    def hiddenItemDescs(self):
        return self._hiddenItemDescs

    @hiddenItemDescs.setter
    def hiddenItemDescs(self, value):
        self._hiddenItemDescs = value

    @property
    def grabbables(self):
        return self._grabbables

    @grabbables.setter
    def grabbables(self, value):
        self._grabbables = value

    @property
    def grabbableDescs(self):
        return self._grabbableDesc

    @grabbableDescs.setter
    def grabbableDescs(self, value):
        self._grabbableDesc = value

    @property
    def interactables(self):
        return self._interactables

    @interactables.setter
    def interactables(self, value):
        self._interactables = value

    @property
    def interactableDescs(self):
        return self._interactableDescs

    @interactableDescs.setter
    def interactableDescs(self, value):
        self._interactableDescs = value

    @property
    def interactableState(self):
        return self._interactableState

    @interactableState.setter
    def interactableState(self, value):
        self._interactableState = value

    @property
    def interactableReqs(self):
        return self._interactableReqs

    @interactableReqs.setter
    def interactableReqs(self, value="on"):
        self._interactableReqs = value

    # adds an exit to the room
    # the exit is a string (e.g., north)
    # the room is an instance of a room
    def addExit(self, exit, room):
        # append the exit and room to the appropriate lists
        self._exits.append(exit)
        self._exitLocations.append(room)

    def delExit(self, exit, room):
        self._exits.remove(exit)
        self._exitLocations.remove(room)

    # adds an item to the room
    # the item is a string (e.g., table)
    # the desc is a string that describes the item (e.g., it is made of wood)
    def addItem(self, item, desc):
        # append the item and description to the appropriate lists
        self._items.append(item)
        self._itemDescs.append(desc)

    def addHiddenItem(self, item, desc):
        self._hiddenItems.append(item)
        self._hiddenItemDescs.append(desc)

    # adds a grabbable item to the room
    # the item is a string (e.g., key)
    def addGrabbable(self, item, desc):
        # append the item to the list
        self._grabbables.append(item)
        self._grabbableDesc.append(desc)

    # removes a grabbable item from the room
    # the item is a string (e.g., key)
    def delGrabbable(self, item, desc):
        # remove the item from the list
        self._grabbables.remove(item)
        self._grabbableDesc.remove(desc)

    def addInteractable(self, item, desc, state, reqs):
        self._interactables.append(item)
        self._interactableDescs.append(desc)
        self._interactableState.append(state)
        self._interactableReqs.append(reqs)

    # returns a string description of the room
    def __str__(self):
        # first, the room name
        if (currentRoom in [r0, r4, r5, r8, r9]):
            s = "You are {}.\n".format(self.name)
        else:
            s = "You are in {}.\n".format(self.name)

        # next, the items in the room
        s += "You see: "
        for item in self.items:
            s += item + " "
        for interactable in self.interactables:
            s += interactable + " "
        s += "\n"

        # next, the exits from the room
        s += "Exits: "
        for exit in self.exits:
            s += exit + " "

        return s


###############################################################################
# creates the rooms
def createRooms():
    global currentRoom, r0, r4, r5, r8, r9, r12

    # Generates all of the empty rooms
    r1 = Room("an office")
    r2 = Room("a library")
    r3 = Room("a sunroom")
    r4 = Room("at the top of a stairwell")
    r5 = Room("at the bottom of a stairwell")
    r6 = Room("a sitting room")
    r7 = Room("a kitchen")
    r8 = Room("at the top of a dark stairwell")
    r9 = Room("at the bottom of a stairwell, in a basement")
    r10 = Room("a basement")
    r11 = Room("a basement")
    r12 = Room("a basement")
    r0 = Room("outside")

    # Generates the office
    r1.addExit("north", r1)
    r1.addExit("east", r3)
    r1.addGrabbable("keycard", "It is used to prove one's credentials.")
    r1.addItem("desk", "A modern desk, made of glass and carbon-fiber. "
               "There is a keycard on the desk\nbeside an inlaid terminal.")
    r1.addItem("chair", "It is smooth, black, and shiny.")
    r1.addItem("terminal", "The terminal glows an amber color. "
               "There is text on the screen.")
    r1.addHiddenItem("text", "The terminal displays a draft of a message to "
                     "the separatist chancellor about\ntransporting a bomb "
                     "out of the basement.")

    # Generates the library
    r2.addExit("south", r1)
    r2.addItem("rug", "It is awfully plush.")
    r2.addItem("fireplace", "It is warm, but dying.")
    r2.addItem("bookshelves", "The bookshelves are neatly packed with books.\n"
               "One of the books is not flush with the others.")
    r2.addGrabbable("journal", "\"Some poignant world-building.\"")

    # Generates room 3
    r3.addExit("north", r4)
    r3.addExit("west", r1)
    r3.addExit("south", None)
    r3.addItem("statue", "It has an oddly fascist feel to it... Perhaps it is "
               "because of the sieg heil pose.")
    r3.addItem("couch", "Rather plain, given the ornate statue nearby.")

    r4.addExit("south", r3)
    r4.addExit("down", r5)
    r4.addItem("stairwell", "There is some light downstairs, and an..."
               "interesting smell wafts through.")

    r5.addExit("up", r4)
    r5.addExit("west", r6)
    r5.addItem("stairwell", "It's rather dark upstairs, now that your eyes"
               "have adjusted.")

    r6.addExit("east", r5)
    r6.addExit("south", r7)
    r6.addExit("west", r0)

    r7.addExit("north", r6)
    r7.addExit("east", r8)

    r8.addExit("west", r7)
    r8.addExit("down", r9)

    r9.addExit("up", r8)
    r9.addExit("west", r10)

    r10.addExit("east", r9)
    r10.addExit("north", r11)

    r11.addExit("south", r10)
    r11.addExit("east", r12)

    r12.addExit("west", r11)
    r12.addInteractable("bomb", "It must be deactivated to save the Alliance. "
                        "There is a card slot on the side.", "on", "keycard")

    r0.addExit("east", r6)
    r0.addItem("trees", "The tree is devoid of leaves. This would lead you "
               "to assume that it is winter,\nexcept for the fact that it is "
               "hot enough to fry an egg.")
    r0.addItem("grass", "The grass is brown and dead.")

    currentRoom = r1


# displays an appropriate "message" when the player dies
# yes, this is intentionally obfuscated!
def death():
    print " " * 17 + "u" * 7
    print " " * 13 + "u" * 2 + "$" * 11 + "u" * 2
    print " " * 10 + "u" * 2 + "$" * 17 + "u" * 2
    print " " * 9 + "u" + "$" * 21 + "u"
    print " " * 8 + "u" + "$" * 23 + "u"
    print " " * 7 + "u" + "$" * 25 + "u"
    print " " * 7 + "u" + "$" * 25 + "u"
    print " " * 7 + "u" + "$" * 6 + "\"" + " " * 3 + "\"" + "$" * 3 + "\"" " " * 3 + "\"" + "$" * 6 + "u"
    print " " * 7 + "\"" + "$" * 4 + "\"" + " " * 6 + "u$u" + " " * 7 + "$" * 4 + "\""
    print " " * 8 + "$" * 3 + "u" + " " * 7 + "u$u" + " " * 7 + "u" + "$" * 3
    print " " * 8 + "$" * 3 + "u" + " " * 6 + "u" + "$" * 3 + "u" + " " * 6 + "u" + "$" * 3
    print " " * 9 + "\"" + "$" * 4 + "u" * 2 + "$" * 3 + " " * 3 + "$" * 3 + "u" * 2 + "$" * 4 + "\""
    print " " * 10 + "\"" + "$" * 7 + "\"" + " " * 3 + "\"" + "$" * 7 + "\""
    print " " * 12 + "u" + "$" * 7 + "u" + "$" * 7 + "u"
    print " " * 13 + "u$\"$\"$\"$\"$\"$\"$u"
    print " " * 2 + "u" * 3 + " " * 8 + "$" * 2 + "u$ $ $ $ $u" + "$" * 2 + " " * 7 + "u" * 3
    print " u" + "$" * 4 + " " * 8 + "$" * 5 + "u$u$u" + "$" * 3 + " " * 7 + "u" + "$" * 4
    print " " * 2 + "$" * 5 + "u" * 2 + " " * 6 + "\"" + "$" * 9 + "\"" + " " * 5 + "u" * 2 + "$" * 6
    print "u" + "$" * 11 + "u" * 2 + " " * 4 + "\"" * 5 + " " * 4 + "u" * 4 + "$" * 10
    print "$" * 4 + "\"" * 3 + "$" * 10 + "u" * 3 + " " * 3 + "u" * 2 + "$" * 9 + "\"" * 3 + "$" * 3 + "\""
    print " " + "\"" * 3 + " " * 6 + "\"" * 2 + "$" * 11 + "u" * 2 + " " + "\"" * 2 + "$" + "\"" * 3
    print " " * 11 + "u" * 4 + " \"\"" + "$" * 10 + "u" * 3
    print " " * 2 + "u" + "$" * 3 + "u" * 3 + "$" * 9 + "u" * 2 + " \"\"" + "$" * 11 + "u" * 3 + "$" * 3
    print " " * 2 + "$" * 10 + "\"" * 4 + " " * 11 + "\"\"" + "$" * 11 + "\""
    print " " * 3 + "\"" + "$" * 5 + "\"" + " " * 22 + "\"\"" + "$" * 4 + "\"\""
    print " " * 5 + "$" * 3 + "\"" + " " * 25 + "$" * 4 + "\""


def trap():
    sleep(5)
    response = "The bomb starts ticking! Whoops!"
    print "\n{}".format(response)
    sleep(5)
    death()


###############################################################################
# START THE GAME!!!
createRooms()
inventory = []
inventoryDesc = []
directions = ["north", "south", "east", "west", "up", "down"]
shortcuts = ["n", "s", "e", "w", "u", "d"]

while True:
    if (currentRoom is None):
        death()
        break

    if (currentRoom == r12):
        if (currentRoom.interactableState[[i for i, j in enumerate(currentRoom.interactables) if j == 'bomb'][0]] == "off"):
            trap()
            break

    # if ("keycard" in inventory):

    status = "{}\nYou are carrying: {}\n".format(currentRoom, inventory)

    print "=================================================================="\
          "============="
    print status

    action = raw_input("What do you want to do? ")
    action = action.lower()

    while (action == ""):
        action = raw_input("")
        action = action.lower()
    else:
        response = "I don't understand. Try valid noun.\n"\
            "Valid verbs are:\n\n[go, head]\n[look, check]\n[take, get]"

    if (action in ["quit", "exit", "bye"]):
        break

    words = action.split()
    if (len(words) == 2):
        verb = words[0]
        noun = words[1]

        if (verb in ["go", "head"]):
            response = "Invalid exit"

            if (noun in shortcuts):
                noun = directions[shortcuts.index(noun)]

            for i in range(len(currentRoom.exits)):
                if (noun == currentRoom.exits[i]):
                    currentRoom = currentRoom.exitLocations[i]

                    response = "Room changed."

                    break

        elif (verb in ["look", "check"]):
            response = "I don't see that item."

            for i in range(len(currentRoom.items)):
                if (noun == currentRoom.items[i]):
                    response = currentRoom.itemDescs[i]
                    break

            for i in range(len(currentRoom.interactables)):
                if (noun == currentRoom.interactables[i]):
                    response = currentRoom.interactableDescs[i]
                    break

            for i in range(len(currentRoom.hiddenItems)):
                if (noun == currentRoom.hiddenItems[i]):
                    response = currentRoom.hiddenItemDescs[i]
                    break

            for i in range(len(currentRoom.grabbables)):
                if (noun == currentRoom.grabbables[i]):
                    response = currentRoom.grabbableDescs[i]
                    break

            for i in range(len(inventory)):
                if (noun == inventory[i]):
                    response = inventoryDesc[i]
                    break

        elif (verb in ["take", "get"]):
            response = "I don't see that item."
            for i in range(len(currentRoom.grabbables)):
                if (noun == currentRoom.grabbables[i]):
                    inventory.append(currentRoom.grabbables[i])
                    inventoryDesc.append(currentRoom.grabbableDescs[i])
                    currentRoom.delGrabbable(currentRoom.grabbables[
                                             i], currentRoom.grabbableDescs[i])

                    response = "Item grabbed."
                    break

        elif (verb in ["use"]):
            response = "You don't have that item."
            for item in inventory:
                if (noun == item):
                    response = "{} could not be used".format(item)
                    for i in range(len(currentRoom.interactableReqs)):
                        if (noun == currentRoom.interactableReqs[i]):
                            if (currentRoom.interactableState[i] == "on"):
                                currentRoom.interactableState[i] = "off"
                            elif (currentRoom.interactableState[i] == "off"):
                                currentRoom.interactableState[i] = "on"

                            response = "{} used.".format(item)
                            break
    print "\n{}".format(response)
